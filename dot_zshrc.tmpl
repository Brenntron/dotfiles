# If you come from bash you might have to change your $PATH.
export PATH=$HOME/bin:/usr/local/bin:$PATH

# Path to your oh-my-zsh installation.
export ZSH="${HOME}/.oh-my-zsh"

source $ZSH/oh-my-zsh.sh
{{ if eq .chezmoi.os "linux" }}
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
{{ else if eq .chezmoi.os "darwin" }}
export PATH="/opt/homebrew/bin:$PATH"
{{ end }}
# FZF setup
source ~/.config/fzf/fzf.zsh

# asdf setup
source ~/.config/asdf/asdf_setup.zsh

# obsidianmd-cli completions
source ~/.config/completions/obsidianmd.zsh

# Custom syntax highlighting must come before activating zsh-syntax-highlighting
# source ~/.config/tokyonight/zsh-syntax-highlighting.zsh
source ~/.config/catppuccin/zsh-syntax-highlighting/themes/catppuccin_macchiato-zsh-syntax-highlighting.zsh

# Antigen plugins
source $(brew --prefix)/share/antigen/antigen.zsh

antigen use oh-my-zsh

antigen bundle aliases
antigen bundle atuinsh/atuin@main
antigen bundle brew
antigen bundle bundler
antigen bundle command-not-found
antigen bundle compleat
antigen bundle containers
antigen bundle copybuffer
antigen bundle copyfile
antigen bundle copypath
antigen bundle cp
antigen bundle docker
antigen bundle dotenv
antigen bundle eza-zsh
antigen bundle fzf
antigen bundle gh
antigen bundle git
antigen bundle gpg-agent
antigen bundle kazhala/dotbare
antigen bundle kitty
antigen bundle npm
antigen bundle pip
antigen bundle podman
antigen bundle rails
antigen bundle rake-fast
antigen bundle rake
antigen bundle react-native
antigen bundle rebar
antigen bundle redxtech/zsh-kitty
antigen bundle rsync
antigen bundle ruby
antigen bundle rust
antigen bundle safe-paste
antigen bundle ssh-agent
antigen bundle ssh
antigen bundle thefuck
antigen bundle themes
antigen bundle uv
antigen bundle vi-mode

# Load order matters; must be last
antigen bundle zdharma-continuum/fast-syntax-highlighting
antigen bundle zsh-users/zsh-autosuggestions
antigen bundle marlonrichert/zsh-autocomplete@main
# redis-cli plugin relies on homebrew completion.
antigen bundle redis-cli
{{ if eq .chezmoi.os "linux" }}
antigen bundle ubuntu
{{ else if eq .chezmoi.os "darwin" }}
antigen bundle macos
antigen bundle xcode
{{ end }}
antigen apply

# oh-my-posh theme
# tokyonight_moon
# eval "$(oh-my-posh init zsh --config ~/.config/tokyonight/oh-my-posh/tokyonight_moon.omp.yaml)"
# Catppuccin Macchiato
eval "$(oh-my-posh init zsh --config ~/.config/catppuccin/oh-my-posh/catppuccin_macchiato.omp.yaml)"

eval $(thefuck --alias)

{{ if eq .chezmoi.os "Linux" }}
export KERL_CONFIGURE_OPTIONS="--disabled-debug --without-javac --disable-hipe --with-ssl=$(brew --prefix openssl)"
export SSH_AUTH_SOCK=~/.1password/agent.sock

export PYENV_ROOT="$HOME/.pyenv"
[[ -d $PYENV_ROOT/bin ]] && export PATH="$PYENV_ROOT/bin:$PATH"
eval "$(pyenv init -)"

skip_global_compinit=1
{{ else if eq .chezmoi.os "darwin" }}
ssh-add --apple-use-keychain

export KERL_CONFIGURE_OPTIONS="--disable-debug --disable-silent-rules --without-javac --enable-shared-zlib --enable-dynamic-ssl-lib --enable-hipe --enable-sctp --enable-smp-support --enable-threads --enable-kernel-poll --enable-wx --enable-darwin-64bit --with-ssl=$(brew --prefix openssl)"
export NODE_OPTIONS="--max-old-space-size=8192"
export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES

{{ end }}

# enable autocomplete function
source $(brew --prefix zsh-autocomplete)/share/zsh-autocomplete/zsh-autocomplete.plugin.zsh

# zsh-autocomplete config, Leave out _expand
zstyle ':completion:*' completer _expand_alias _complete _complete:-fuzzy _correct _approximate _ignored

# Uncomment the following line to use case-sensitive completion.
# CASE_SENSITIVE="true"

# Uncomment the following line to use hyphen-insensitive completion.
# Case-sensitive completion must be off. _ and - will be interchangeable.
HYPHEN_INSENSITIVE="true"

# User configuration

# You may need to manually set your language environment
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR='vim'
else
  export EDITOR='nvim'
fi

# Compilation flags
# export ARCHFLAGS="-arch x86_64"

# Set personal aliases, overriding those provided by oh-my-zsh libs,
# plugins, and themes. Aliases can be placed here, though oh-my-zsh
# users are encouraged to define aliases within the ZSH_CUSTOM folder.
# For a full list of active aliases, run `alias`.
#
# Example aliases
# alias zshconfig="mate ~/.zshrc"
# alias ohmyzsh="mate ~/.oh-my-zsh"

export PATH="$(brew --prefix imagemagick@6)/bin:$PATH"
export PATH="$(brew --prefix openssl@3)/bin:$PATH"
export PATH="$(brew --prefix make)/libexec/gnubin:$PATH"

export PATH="${HOME}/.local/bin:$PATH"
export PATH="/usr/local/sbin:$PATH"

export XDG_CONFIG_HOME="${HOME}/.config"
export YAMLLINT_CONFIG_FILE="${XDG_CONFIG_HOME}/yamllint/config.yml"
export PRETTIERD_DEFAULT_CONFIG="~/.config/prettier/prettier.config.js"

# vivid/colorls setup
export LS_COLORS="$(vivid generate catppuccin-macchiato)"

# Homebrew aliases
alias bsc="brew services cleanup"
alias bsl="brew services list"
alias bsp="brew services stop"
alias bsr="brew services restart"
alias bss="brew services start"

# Betterdiscord alias
alias betterdiscord-update="DISC_CONFIG=\"\$HOME/.var/app/com.discordapp.Discord/config/discord\" && BD_ASAR=betterdiscord.asar && wget --timestamping -P \"\${DISC_CONFIG}/../BetterDiscord/data\" -- \"https://github.com/BetterDiscord/BetterDiscord/releases/latest/download/\${BD_ASAR}\" && DISC_VER=\"\$(ls --sort=time --time=creation \"\${DISC_CONFIG}\" | grep -E -m 1 '^[0-9]+\\.[0-9]+\\.[0-9]+\$')\" && echo -e \"require('../../../../BetterDiscord/data/\${BD_ASAR}');\\nmodule.exports = require('./core.asar');\" | tee \"\${DISC_CONFIG}/\${DISC_VER}/modules/discord_desktop_core/index.js\" && echo -e \"\\nBetterDiscord installed. Restart Discord if currently running.\" || echo -e \"\\nInstallation failed.\""

# Tre setup
tre() { command tre "$@" -e && source "/tmp/tre_aliases_$USER" 2>/dev/null; }

alias zshrc='${=EDITOR} ${ZDOTDIR:-$HOME}/.zshrc' # Quick access to the .zshrc file

alias cc='gcc'
alias CC='gcc'

# Openssl setup
export LDFLAGS="-Wl,-rpath,$(brew --prefix openssl@3)/lib"
export CPPFLAGS="-I$(brew --prefix openssl@3)/include"
export OPENSSLDIR="$(brew --prefix openssl@3)"
export CONFIGURE_OPTS="--with-ssl=$(brew --prefix openssl@3) --with-openssl=$(brew --prefix openssl@3) --with-openssl-rpath=auto"

# Lazygit setup

# Lazydocker setup
export DOCKER_HOST=unix:///run/user/1000/podman/podman.sock
alias docker='podman'

# Podman Compose aliases
alias pc='podman compose'

# Yarn aliases
source ~/.config/zsh/yarn.zsh

# enable alias-finder
zstyle ':omz:plugins:alias-finder' autoload yes # disabled by default

alias spectral='spectral-language-server'

# kitty completeions
__kitty_complete

# use bat as a colorizing pager for man
export MANPAGER="sh -c 'col -bx | bat -l man -p'"
# Uncomment below if you experience formatting problems
# export MANROFFOPT="-c"

# Ripgrep config
export RIPGREP_CONFIG_PATH="${XDG_CONFIG_HOME}/ripgrep/.ripgreprc"

{{ if eq .chezmoi.os "linux" }}
export WINEPREFIX="${HOME}/.wine32 winecfg"
export WINEARCH="win32"
{{ end }}

eval "$(zoxide init zsh)"

# Bun
export PATH="${HOME}/.bun/bin:$PATH"

# AWS Completions
{{ if eq .chezmoi.os "darwin" }}
source "/usr/local/bin/aws_zsh_completer.sh"
{{ else }}
autoload -Uz compinit && compinit
if command -v aws_completer >/dev/null 2>&1; then
    complete -C aws_completer aws
fi
{{ end }}

# Enable vi mode
bindkey -v
